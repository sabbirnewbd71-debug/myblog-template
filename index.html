<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Firebase Comments</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; background:#f9f9f9; padding:10px; }
.comment { background:#fff; padding:10px; border-radius:8px; margin-bottom:10px; }
.comment small { color:#777; font-size:12px; }
textarea { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; }
button { margin-top:5px; padding:6px 12px; border:none; border-radius:6px; background:#2196f3; color:#fff; cursor:pointer; }
</style>
</head>
<body>

<h3>Comments</h3>
<div id="comment-list">Loading...</div>

<textarea id="comment-input" placeholder="Write your comment..."></textarea>
<br>
<input type="text" id="comment-name" placeholder="Your name">
<br>
<button id="post-btn">Post Comment</button>

<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

<script>
// âœ… Your Firebase config here
const firebaseConfig = {
  apiKey: "AIzaSyBfike0wB3C8CZWPY8yRhlMS9w-ZPWzb3o",
 authDomain: "hosting-project-2a2ea.firebaseapp.com",
   projectId: "hosting-project-2a2ea",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Get postId from URL parameter
const urlParams = new URLSearchParams(window.location.search);
const postId = urlParams.get('postId') || 'default';

// Refs
const list = document.getElementById('comment-list');
const nameInput = document.getElementById('comment-name');
const commentInput = document.getElementById('comment-input');
const postBtn = document.getElementById('post-btn');

// Listen to comments (live)
db.collection("comments")
  .where("postId", "==", postId)
  .orderBy("createdAt", "asc")
  .onSnapshot(snapshot => {
    list.innerHTML = "";
    if (snapshot.empty) {
      list.innerHTML = "<p>No comments yet</p>";
    } else {
      snapshot.forEach(doc => {
        const c = doc.data();
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `<b>${c.name}</b><br>${c.text}<br><small>${c.createdAt?.toDate().toLocaleString() || ""}</small>`;
        list.appendChild(div);
      });
    }
  });

// Post comment
postBtn.onclick = async () => {
  const name = nameInput.value.trim() || "Anonymous";
  const text = commentInput.value.trim();
  if (!text) return alert("Write something first!");
  await db.collection("comments").add({
    postId,
    name,
    text,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  commentInput.value = "";
};
</script>

</body>
</html>
